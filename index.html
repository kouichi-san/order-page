<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ping-Pong-Pang｜翌日受け取り 注文</title>
<style>
  :root{
    --bg:#fafafa; --ink:#1f2937; --muted:#6b7280; --brand:#0ea5e9; --border:#e5e7eb;
    --wrap:1080px;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,"Segoe UI","Hiragino Kaku Gothic ProN",Meiryo,sans-serif;color:var(--ink);background:var(--bg)}
  .wrap{max-width:var(--wrap);margin:0 auto;padding:0 16px}

  header{position:static;background:#fff;border-bottom:1px solid var(--border)}
  .topbar{height:56px;display:flex;align-items:center;justify-content:space-between}
  .brand{font-weight:800;letter-spacing:.02em}
  .nav{font-size:13px;color:var(--muted)}

  /* 一覧 */
  .cards{display:grid;grid-template-columns:1fr;gap:16px;padding:16px 0 96px}
  @media(min-width:900px){.cards{grid-template-columns:1fr 1fr}}

  /* カード */
  .ppp-card{background:#fff;border:1px solid var(--border);border-radius:16px;overflow:hidden}
  .ppp-fig{height:260px;background:#f3f4f6;position:relative}
  .ppp-fig>img{width:100%;height:100%;object-fit:cover;object-position:center}
  .ppp-sold{position:absolute;inset:0;background:rgba(0,0,0,.42);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:900;letter-spacing:.2em}

  .ppp-body{display:grid;gap:10px;padding:12px}
  .ppp-ttl{font-weight:800;line-height:1.3;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;overflow:hidden;min-height:calc(1.3em * 2)}
  .ppp-prenote{font-size:12px;background:#f8fafc;border:1px solid var(--border);border-radius:10px;padding:6px 8px}
  .ppp-badges{display:flex;gap:6px;overflow:hidden}
  .ppp-badge{flex:0 0 auto;max-width:25%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;border:1px solid var(--border);border-radius:999px;padding:4px 8px;font-size:11px;font-weight:700;letter-spacing:.02em;background:#fff}

  .ppp-price{font-weight:900;font-size:18px;margin-top:4px}
  .ppp-descwrap{display:grid;grid-template-columns:1fr auto;gap:8px;align-items:end;padding:0 12px 12px}
  .ppp-desc{font-size:13px;color:#4b5563;line-height:1.5;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:3;overflow:hidden;min-height:calc(1.5em * 3)}
  .ppp-more{font-size:13px;color:#111827;opacity:.6}

  .ppp-actions{display:grid;grid-template-columns:3fr 2fr;gap:8px}
  .ppp-btn{appearance:none;border:1px solid #e5e7eb;background:#fff;color:#111827;padding:0 12px;border-radius:12px;cursor:pointer;font-weight:800;min-height:44px}
  .ppp-btn.add{background:#0ea5e9;color:#fff}

  .ppp-vars{display:flex;gap:8px;flex-wrap:wrap}
  .ppp-pill{border:1px solid #e5e7eb;background:#fff;padding:8px 10px;border-radius:10px;cursor:pointer;font-weight:700;font-size:13px}

  .ppp-descwrap{display:grid;grid-template-columns:1fr auto;gap:8px;align-items:end;padding:0 12px 12px}
  .ppp-desc{font-size:13px;color:#4b5563;line-height:1.5;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:3;overflow:hidden;min-height:calc(1.5em * 3)}
  .ppp-more{font-size:13px;color:#111827;opacity:.6}

  /* カートバー */
  .cartbar{position:fixed;left:0;right:0;bottom:0;background:rgba(0,0,0,.9);backdrop-filter:blur(6px);border-top:1px solid rgba(0,0,0,.08);color:#fff}
  .cartbar .inner{max-width:var(--wrap);margin:0 auto;padding:10px 16px;display:flex;align-items:center;gap:12px}
  .cartinfo{font-size:13px;opacity:.9}
  .cartgo{margin-left:auto;background:#0ea5e9;border:none;color:#fff;border-radius:10px;height:40px;padding:0 12px;font-weight:900;cursor:pointer}

  /* テキスト */
  .muted{color:#6b7280;letter-spacing:.01em}
  .tag{font-size:12px;color:var(--muted)}

  /* === ここから追記：ボタン折り返し＆高さ崩れの完全封じ（最小変更） === */
  .ppp-btn{
    /* 折り返し防止＋はみ出しは省略 */
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    /* 高さを固定して縦中央 */
    height: 44px !important;
    line-height: 44px !important;
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    gap: .5em;
    /* flex収縮で省略記号を効かせる必須指定 */
    min-width: 0 !important;
  }
  .ppp-btn .label{ flex:1 1 auto; min-width:0; }
  .ppp-btn .ico{ flex:0 0 auto; }
  /* 狭幅での微縮小（最小限） */
  @media (max-width:380px){ .ppp-btn{ font-size:.95em; } }
  @media (max-width:340px){ .ppp-btn{ font-size:.9em; } }
</style>
</head>
<body>
<header>
  <div class="wrap topbar">
    <div class="brand">Ping-Pong-Pang</div>
    <nav class="nav">カテゴリ / 新着 / 売れ筋 / お気に入り</nav>
  </div>
</header>

<main class="wrap">
  <section id="cards" class="cards" aria-live="polite"></section>
</main>

<!-- 下部カートバー（既存仕様のまま） -->
<div class="cartbar">
  <div class="inner">
    <div class="cartinfo"><span id="cartCount">0</span> 点 / <span id="cartTotal">¥0</span></div>
    <button class="cartgo">カートを見る</button>
  </div>
</div>

<footer>
  <div class="wrap" style="padding:12px 16px;color:#6b7280;font-size:13px;text-align:center">© Ping-Pong-Pang</div>
</footer>

<script>
/* ===== 設定 ===== */
const PRODUCTS_URL = ""; // GASのJSONエンドポイント（空ならダミーを使用）

/* ===== 便利関数 ===== */
const qs=s=>document.querySelector(s), qsa=s=>Array.from(document.querySelectorAll(s));
const yen=n=>"¥"+(n||0).toLocaleString("ja-JP");
const esc=s=>(s==null?"":String(s)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");

/* ===== ダミーデータ（URL未設定時） ===== */
const DUMMY=[
  {id:"A001",name:"ロティサリーチキン（フル）",prenote:"温めるだけの最強おかず",badges:["定番","人気","リピ多数"],desc:"しっとり柔らか、家族サイズで大満足。",price:998,img:"https://picsum.photos/seed/a/900/600",sold:false},
  {id:"B002",name:"ディナーロール 36個",prenote:"冷凍ストック推奨",badges:["限定","コスパ"],desc:"朝食・おやつ・非常食に。",price:580,img:"https://picsum.photos/seed/b/900/600",sold:false},
  {id:"C003",name:"プルコギビーフ（小分け）",prenote:"焼くだけ5分",badges:["小分け","時短"],desc:"甘辛タレでご飯が進む王道。",price:980,img:"https://picsum.photos/seed/c/900/600",sold:false},
  {id:"D004",name:"トリプルチーズタルト",prenote:"冷やして美味",badges:["数量限定","スイーツ"],desc:"濃厚だけど重すぎない。",price:1580,img:"https://picsum.photos/seed/d/900/600",sold:true}
];

/* ===== 描画 ===== */
function cardHTML(p){
  const badges=(p.badges||[]).slice(0,3).map(b=>`<span class="ppp-badge">${esc(b)}</span>`).join("");
  return `
  <article class="ppp-card" data-id="${esc(p.id)}">
    <figure class="ppp-fig">
      <img src="${esc(p.img||'')}" alt="${esc(p.name)}" decoding="async" loading="lazy">
      ${p.sold?`<div class="ppp-sold">SOLD OUT</div>`:""}
    </figure>
    <div class="ppp-body">
      <h3 class="ppp-ttl">${esc(p.name)}</h3>
      ${p.prenote?`<div class="ppp-prenote">${esc(p.prenote)}</div>`:""}
      <div class="ppp-badges">${badges}</div>
      <div style="padding:0 12px 0">
        <div class="ppp-price">${yen(p.price)}</div>
      </div>
      <div class="ppp-descwrap">
        <p class="ppp-desc">${esc(p.desc||"")}</p>
        <a class="ppp-more" href="#">もっと見る</a>
      </div>
      <div class="ppp-actions" style="padding:0 12px 12px">
        <button class="ppp-btn add" data-add="${esc(p.id)}">
          <span class="ico">🛒</span>
          <span class="label" data-short="追加">カートに入れる</span>
        </button>
        <button class="ppp-btn" data-later="${esc(p.id)}">
          <span class="ico">⭐</span>
          <span class="label" data-short="保存">あとで買う</span>
        </button>
      </div>
      <div class="ppp-vars" style="padding:0 12px 12px">
        ${p.var1?`<button class="ppp-pill">${esc(p.var1)}</button>`:""}
        ${p.var2?`<button class="ppp-pill">${esc(p.var2)}</button>`:""}
      </div>
    </div>
  </article>`;
}

/* ===== データ取得 ===== */
let PRODUCTS=[], productById=new Map();
async function loadProducts(){
  const container=qs('#cards');
  container.innerHTML="";
  try{
    let list=DUMMY;
    if(PRODUCTS_URL){
      const res=await fetch(PRODUCTS_URL,{cache:"no-store",credentials:"omit"});
      const data=await res.json();
      list=Array.isArray(data)?data:(data.items||[]);
    }
    PRODUCTS=list.map(x=>({
      id:String(x.id), name:x.name, prenote:x.prenote, badges:x.badges||[],
      desc:x.desc, price:Number(x.price||0), img:x.img, sold:Boolean(x.sold),
      var1:x.var1, var2:x.var2, active:Boolean(x.active), leadDays:Number(x.leadDays||1)
    }));
    productById=new Map(PRODUCTS.map(p=>[p.id,p]));
    renderProducts();
  }catch(e){console.error(e);}
}
function renderProducts(){
  qs('#cards').innerHTML=PRODUCTS.map(cardHTML).join("");
  applyShortLabelsIfNarrow();
}

/* ===== ラベル短縮（狭幅時のみ） ===== */
function applyShortLabelsIfNarrow(){
  const narrow=window.matchMedia('(max-width:360px)').matches;
  qsa('.ppp-btn .label').forEach(el=>{
    const short=el.dataset.short;
    if(narrow && short) el.textContent=short;
  });
}

/* ===== カート（超ミニ実装） ===== */
const CART={items:[]}; // [{id,qty,price}]
const totals=()=>({
  cnt:CART.items.reduce((a,b)=>a+b.qty,0),
  sum:CART.items.reduce((a,b)=>a+(b.price*b.qty),0)
});
function renderCartBar(){
  const t=totals();
  qs('#cartCount').textContent=t.cnt;
  qs('#cartTotal').textContent=yen(t.sum);
}
function addToCart(p,qty){
  const found=CART.items.find(it=>it.id===p.id);
  if(found) found.qty+=qty; else CART.items.push({id:p.id,qty:qty,price:p.price});
  renderCartBar();
}

/* ===== イベント ===== */
document.addEventListener('click',ev=>{
  const add=ev.target.closest('.ppp-btn.add[data-add]'); if(add){ ev.preventDefault(); const p=productById.get(add.dataset.add); if(p) addToCart(p,1);}
  const later=ev.target.closest('.ppp-btn[data-later]'); if(later){ ev.preventDefault(); const set=later.getAttribute('data-set')==='1'?'0':'1'; later.setAttribute('data-set',set); later.querySelector('.label').textContent=set==='1'?'あとで買う済':'あとで買う';}
},{passive:false});

window.addEventListener('resize',applyShortLabelsIfNarrow,{passive:true});

loadProducts(); renderCartBar();
</script>
</body>
</html>
