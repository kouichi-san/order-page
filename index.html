<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>PPP | å•†å“ä¸€è¦§</title>
<style>
  :root{
    --wrap:1080px;         /* PCä¸Šé™ */
    --gap:16px;
    --card-img-h:260px;    /* ç”»åƒã®é«˜ã•å›ºå®š */
    --btn-h:44px;          /* ãƒœã‚¿ãƒ³é«˜ã•ï¼ˆSPã§ã‚‚æŠ¼ã—ã‚„ã™ã„ï¼‰ */
    --radius:16px;
  }
  html,body{margin:0;padding:0;background:#111;color:#fff;font-family:system-ui,"Hiragino Kaku Gothic ProN",Meiryo,Arial,sans-serif;}
  a{color:inherit;text-decoration:none}
  img{display:block;max-width:100%;}

  /* ã‚³ãƒ³ãƒ†ãƒŠï¼šç«¯æœ«å¹…ã„ã£ã±ã„ï¼‹PCã¯ä¸Šé™ã§ä¸­å¤®å¯„ã› */
  .wrap{max-width:var(--wrap);width:100%;margin:0 auto;padding:0 12px;}

  header,footer{position:sticky;z-index:10;background:#000;}
  header{top:0;border-bottom:1px solid #222;}
  footer{bottom:0;border-top:1px solid #222;}
  .bar{height:52px;display:flex;align-items:center;justify-content:space-between;padding:0 12px;}

  /* ã‚«ãƒ¼ãƒ‰ä¸€è¦§ï¼šPCã¯2åˆ—ã€SPã¯1åˆ— */
  .cards{
    display:grid;
    grid-template-columns:1fr;
    gap:var(--gap);
    padding:16px 0 88px; /* ã‚«ãƒ¼ãƒˆãƒãƒ¼åˆ†ã®ã‚¹ãƒšãƒ¼ã‚¹ */
  }
  @media (min-width: 900px){
    .cards{ grid-template-columns:1fr 1fr; }
  }

  /* ã‚«ãƒ¼ãƒ‰ */
  .card{
    background:#181818; border:1px solid #252525; border-radius:var(--radius);
    overflow:hidden; display:grid; grid-template-rows:
      var(--card-img-h)  /* ç”»åƒ */
      auto               /* ã‚¿ã‚¤ãƒˆãƒ« */
      auto               /* ãƒ—ãƒ¬ãƒãƒ¼ãƒˆ/ãƒãƒƒã‚¸è¡Œ */
      minmax(0,1fr)      /* èª¬æ˜ï¼ˆä½™ã‚Šã§ä¼¸ç¸®ï¼‰ */
      auto;              /* ãƒœã‚¿ãƒ³è¡Œ */
  }
  .card .img{
    background:#0c0c0c; position:relative;
  }
  .card .img > img{
    width:100%; height:var(--card-img-h); object-fit:cover; object-position:center;
  }
  .card .body{ padding:12px; display:grid; gap:10px; }

  .ttl{
    font-weight:700; font-size:16px; line-height:1.3;
    display:-webkit-box; -webkit-box-orient:vertical; -webkit-line-clamp:2; overflow:hidden;
    min-height:calc(1.3em * 2);
  }
  .prenote{
    font-size:12px; color:#ddd; background:#202020; border:1px solid #2a2a2a;
    padding:6px 8px; border-radius:10px;
  }
  .badges{ display:flex; gap:6px; flex-wrap:nowrap; overflow:hidden; }
  .badge{
    flex:0 0 auto; min-width:0; max-width:25%;
    font-size:11px; font-weight:700; letter-spacing:.02em;
    background:#2a2a2a; border:1px solid #333; border-radius:999px; padding:4px 8px;
    white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  }

  .desc{
    color:#ccc; font-size:13px; line-height:1.5;
    display:-webkit-box; -webkit-box-orient:vertical; -webkit-line-clamp:3; overflow:hidden;
    position:relative; padding-right:14px; min-height:calc(1.5em * 3);
  }
  .desc::after{ /* å³ä¸‹ã«çŸ¢å° */
    content:"â†’"; position:absolute; right:0; bottom:0; opacity:.6; font-weight:700;
  }

  .price{
    margin-top:4px; font-weight:800; font-size:18px;
  }

  /* ãƒœã‚¿ãƒ³è¡Œï¼é«˜ã•ä¸€å®šã€‚ãƒœã‚¿ãƒ³ã¯çµ¶å¯¾ã«æŠ˜ã‚Šè¿”ã•ãªã„ */
  .actions{ display:flex; gap:8px; }
  .ppp-btn{
    /* æŠ˜ã‚Šè¿”ã—é˜²æ­¢ï¼‹çœç•¥ */
    white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    /* é«˜ã•å›ºå®šï¼ˆç¸¦ä¸­å¤®ï¼‰ */
    height:var(--btn-h); line-height:var(--btn-h);
    display:inline-flex; align-items:center; justify-content:center; gap:.5em;
    /* çœç•¥è¨±å¯ */
    min-width:0;
    /* è¦–èªæ€§ */
    font-weight:700; border-radius:12px; padding:0 12px; border:1px solid transparent;
    background:#2d6cdf; color:#fff;
    flex:1 1 0%;  /* å‡ç­‰ã«å¹…é…åˆ† */
    cursor:pointer;
  }
  .ppp-btn.secondary{ background:#262626; border-color:#333; }
  .ppp-btn:disabled{ opacity:.5; cursor:not-allowed; }
  .ppp-btn .ico{ flex:0 0 auto; }
  .ppp-btn .label{ flex:1 1 auto; min-width:0; }

  /* ç‹­å¹…ç«¯æœ«ã§ã®æ®µéšçš„ç¸®å°ï¼ˆæŠ˜ã‚Šè¿”ã—å›é¿ã®æœ€çµ‚ä¿é™ºï¼‰ */
  @media (max-width: 380px){ .ppp-btn{ font-size:.95em; } }
  @media (max-width: 340px){ .ppp-btn{ font-size:.9em; } }

  /* ä¸‹éƒ¨ã‚«ãƒ¼ãƒˆãƒãƒ¼ï¼ˆã‚¹ãƒãƒ¼ãƒˆè¡¨ç¤ºå¯¾å¿œï¼šã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã§éš ã™/å‡ºã™ï¼‰ */
  .cartbar{
    position:fixed; left:0; right:0; bottom:0; z-index:20;
    padding: env(safe-area-inset-bottom, 0) 0 0;
    background:rgba(0,0,0,.9); backdrop-filter:saturate(1.2) blur(6px);
    border-top:1px solid #222;
    transform:translateY(0); transition:transform .25s ease;
  }
  .cartbar.hide{ transform:translateY(100%); }
  .cartbar .inner{ max-width:var(--wrap); margin:0 auto; padding:8px 12px; display:flex; align-items:center; gap:10px; }
  .cartinfo{ font-size:13px; color:#ddd; }
  .to-cart{ white-space:nowrap; height:40px; line-height:40px; padding:0 12px; border-radius:10px; background:#2d6cdf; color:#fff; font-weight:800; border:none; }

  /* SOLD OUT ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼ˆä»»æ„ï¼‰ */
  .soldout{
    position:absolute; inset:0; background:rgba(0,0,0,.45);
    display:flex; align-items:center; justify-content:center;
    font-weight:900; letter-spacing:.2em; font-size:22px; color:#fff;
  }
</style>
</head>
<body>
  <header><div class="wrap bar">
    <div>Ping-Pong-Pang</div>
    <nav style="opacity:.8;font-size:13px;">ã‚«ãƒ†ã‚´ãƒª / æ–°ç€ / å£²ã‚Œç­‹ / ãŠæ°—ã«å…¥ã‚Š</nav>
  </div></header>

  <main class="wrap">
    <section id="cards" class="cards" aria-live="polite"></section>
  </main>

  <!-- ä¸‹éƒ¨ã‚«ãƒ¼ãƒˆãƒãƒ¼ï¼ˆã‚¹ãƒãƒ¼ãƒˆè¡¨ç¤ºï¼‰ -->
  <div id="cartBar" class="cartbar">
    <div class="inner">
      <div class="cartinfo"><span id="cartCount">0</span> ç‚¹ / <span id="cartTotal">Â¥0</span></div>
      <div style="flex:1 1 auto;"></div>
      <button class="to-cart">ã‚«ãƒ¼ãƒˆã‚’è¦‹ã‚‹</button>
    </div>
  </div>

  <footer><div class="wrap bar" style="justify-content:center;opacity:.7;">Â© Ping-Pong-Pang</div></footer>

<script>
/** ====== è¨­å®š ====== */
/** GASã®Productsã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆJSONï¼‰ã‚’å…¥ã‚Œã‚‹ã¨ãã¡ã‚‰ã‚’èª­ã¿è¾¼ã¿ã¾ã™ã€‚
 *  æœªè¨­å®šï¼ˆç©ºæ–‡å­—ï¼‰ã®å ´åˆã¯ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã§æç”»ã—ã¾ã™ã€‚ */
const PRODUCTS_URL = ""; // ä¾‹: "https://script.google.com/macros/s/xxxx/exec?endpoint=products"

/** ====== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ====== */
const qs = s => document.querySelector(s);
const qsa = s => Array.from(document.querySelectorAll(s));
const yen = n => "Â¥" + (n||0).toLocaleString("ja-JP");

/** ====== ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆPRODUCTS_URLæœªè¨­å®šæ™‚ã«åˆ©ç”¨ï¼‰ ====== */
const DUMMY = [
  { id:"A001", name:"ãƒ­ãƒ†ã‚£ã‚µãƒªãƒ¼ãƒã‚­ãƒ³ï¼ˆãƒ•ãƒ«ï¼‰", prenote:"æ¸©ã‚ã‚‹ã ã‘ã®æœ€å¼·ãŠã‹ãš", badges:["å®šç•ª","äººæ°—","ãƒªãƒ”å¤šæ•°"], desc:"ã—ã£ã¨ã‚ŠæŸ”ã‚‰ã‹ã€å®¶æ—ã‚µã‚¤ã‚ºã§å¤§æº€è¶³ã€‚ã‚µãƒ©ãƒ€ã‚„ã‚µãƒ³ãƒ‰ã«ã‚‚ã€‚", price:998, img:"https://picsum.photos/seed/a/900/600", sold:false },
  { id:"B002", name:"ãƒ‡ã‚£ãƒŠãƒ¼ãƒ­ãƒ¼ãƒ« 36å€‹", prenote:"å†·å‡ã‚¹ãƒˆãƒƒã‚¯æ¨å¥¨", badges:["é™å®š","ã‚³ã‚¹ãƒ‘"], desc:"æœé£Ÿãƒ»ãŠã‚„ã¤ãƒ»éå¸¸é£Ÿã«ã€‚å†·å‡â†’ãƒˆãƒ¼ã‚¹ãƒˆã§ç„¼ããŸã¦æ„Ÿã€‚", price:580, img:"https://picsum.photos/seed/b/900/600", sold:false },
  { id:"C003", name:"ãƒ—ãƒ«ã‚³ã‚®ãƒ“ãƒ¼ãƒ•ï¼ˆå°åˆ†ã‘ï¼‰", prenote:"ç„¼ãã ã‘5åˆ†", badges:["å°åˆ†ã‘","æ™‚çŸ­"], desc:"ç”˜è¾›ã‚¿ãƒ¬ã§ã”é£¯ãŒé€²ã‚€ç‹é“ã€‚å†·å‡åº«ã«å¸¸å‚™æ¨å¥¨ã€‚", price:980, img:"https://picsum.photos/seed/c/900/600", sold:false },
  { id:"D004", name:"ãƒˆãƒªãƒ—ãƒ«ãƒãƒ¼ã‚ºã‚¿ãƒ«ãƒˆ", prenote:"å†·ã‚„ã—ã¦ç¾å‘³", badges:["æ•°é‡é™å®š","ã‚¹ã‚¤ãƒ¼ãƒ„"], desc:"æ¿ƒåšã ã‘ã©é‡ã™ããªã„ã€é£Ÿå¾Œã®å¹¸ã›æ‹…å½“ã€‚", price:1580, img:"https://picsum.photos/seed/d/900/600", sold:true }
];

/** ====== æç”» ====== */
function cardHtml(p){
  const sold = p.sold ? `<div class="soldout">SOLD OUT</div>` : "";
  const badges = (p.badges||[]).slice(0,3).map(b=>`<span class="badge">${escapeHtml(b)}</span>`).join("");
  return `
  <article class="card" data-id="${p.id}">
    <div class="img">
      <img src="${escapeHtml(p.img||'')}" alt="${escapeHtml(p.name)}">
      ${sold}
    </div>
    <div class="body">
      <h3 class="ttl">${escapeHtml(p.name)}</h3>
      ${p.prenote ? `<div class="prenote">${escapeHtml(p.prenote)}</div>` : ``}
      <div class="badges">${badges}</div>
      <div>
        <div class="price">${yen(p.price)}</div>
        <p class="desc">${escapeHtml(p.desc||"")}</p>
      </div>
      <div class="actions">
        <button class="ppp-btn add" data-add="${p.id}">
          <span class="ico">ğŸ›’</span>
          <span class="label" data-short="è¿½åŠ ">ã‚«ãƒ¼ãƒˆã«å…¥ã‚Œã‚‹</span>
        </button>
        <button class="ppp-btn secondary later" data-later="${p.id}">
          <span class="ico">â­</span>
          <span class="label" data-short="ä¿å­˜">ã‚ã¨ã§è²·ã†</span>
        </button>
      </div>
    </div>
  </article>`;
}

/** HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ— */
function escapeHtml(s){ return (s==null?"":String(s))
  .replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"); }

/** ====== ãƒ‡ãƒ¼ã‚¿å–å¾— â†’ ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° ====== */
async function loadProducts(){
  const wrap = qs('#cards');
  wrap.innerHTML = ""; // ã‚¯ãƒªã‚¢
  let list = [];
  if(PRODUCTS_URL){
    try{
      const res = await fetch(PRODUCTS_URL, {credentials:"omit", cache:"no-store"});
      if(!res.ok) throw new Error(res.status+" "+res.statusText);
      const json = await res.json();
      list = Array.isArray(json) ? json : (json.items || []);
    }catch(e){
      console.warn("fetchå¤±æ•—ã€‚ãƒ€ãƒŸãƒ¼ã§æç”»ã—ã¾ã™:", e);
      list = DUMMY;
    }
  }else{
    list = DUMMY;
  }
  // æç”»
  wrap.innerHTML = list.map(cardHtml).join("");
  // ç«¯æœ«ç‹­å¹…ã®ã¨ãã¯ãƒœã‚¿ãƒ³ãƒ©ãƒ™ãƒ«ã‚’çŸ­ç¸®
  applyShortLabelsIfNarrow();
}

/** ç‹­ã„ç«¯æœ«ã§ã¯ data-short ã«ç½®ãæ›ãˆ */
function applyShortLabelsIfNarrow(){
  const narrow = window.matchMedia('(max-width: 360px)').matches;
  qsa('.ppp-btn .label').forEach(el=>{
    const short = el.dataset.short;
    if(narrow && short) el.textContent = short;
  });
}

/** ====== ã‚«ãƒ¼ãƒˆå‘¨ã‚Šï¼ˆæ¥µå°å®Ÿè£…ï¼‰ ====== */
const CART = { items:[] }; // [{id,qty,price}]
function totals(){
  const cnt = CART.items.reduce((a,b)=>a+b.qty,0);
  const sum = CART.items.reduce((a,b)=>a+(b.price*b.qty),0);
  return {cnt,sum};
}
function updateCartBar(){
  const t = totals();
  qs('#cartCount').textContent = t.cnt;
  qs('#cartTotal').textContent = yen(t.sum);
}
function addToCart(id){
  // ãƒ‡ãƒ¢ç”¨ï¼šä¾¡æ ¼ã¯DOMã‹ã‚‰æ‹¾ã†
  const card = document.querySelector(`.card[data-id="${CSS.escape(id)}"]`);
  const price = card ? Number(card.querySelector('.price').textContent.replace(/[^\d]/g,'')) : 0;
  const found = CART.items.find(it=>it.id===id);
  if(found) found.qty += 1; else CART.items.push({id,qty:1,price});
  updateCartBar();
  // è¿½åŠ ç›´å¾Œã¯ãƒãƒ¼è¡¨ç¤ºï¼ˆã‚¹ãƒãƒ¼ãƒˆè¡¨ç¤ºãŒhideä¸­ã§ã‚‚è¦‹ã›ã‚‹ï¼‰
  const bar = qs('#cartBar');
  bar.classList.remove('hide');
  clearTimeout(addToCart._t);
  addToCart._t = setTimeout(()=>bar.classList.add('hide'), 1500);
}

/** ====== ã‚¤ãƒ™ãƒ³ãƒˆ ====== */
document.addEventListener('click', (ev)=>{
  const add = ev.target.closest('.ppp-btn.add[data-add]');
  if(add){
    const id = add.dataset.add;
    addToCart(id);
  }
  const later = ev.target.closest('.ppp-btn.later[data-later]');
  if(later){
    // ãƒ‡ãƒ¢ï¼šãƒˆãƒ¼ã‚¹ãƒˆä»£ã‚ã‚Šã«ä¸€ç¬ã ã‘ãƒœã‚¿ãƒ³æ–‡è¨€ã‚’å¤‰æ›´
    const label = later.querySelector('.label');
    const bak = label.textContent;
    label.textContent = "ä¿å­˜ã—ã¾ã—ãŸ";
    setTimeout(()=>label.textContent=bak, 900);
  }
});

/** ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ–¹å‘ã§ä¸‹éƒ¨ãƒãƒ¼ã®ã‚¹ãƒãƒ¼ãƒˆè¡¨ç¤º */
let _lastY = window.scrollY, _hide = false;
window.addEventListener('scroll', ()=>{
  const y = window.scrollY;
  const down = y > _lastY; _lastY = y;
  const bar = qs('#cartBar');
  if(down && !_hide){ bar.classList.add('hide'); _hide = true; }
  else if(!down && _hide){ bar.classList.remove('hide'); _hide = false; }
},{passive:true});

/** èµ·å‹• */
window.addEventListener('resize', applyShortLabelsIfNarrow, {passive:true});
loadProducts();
updateCartBar();
</script>
</body>
</html>
